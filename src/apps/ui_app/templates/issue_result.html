{% extends "base.html" %}

{% block title %}Issue Result - {{ ui_title }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-10 mx-auto">
        {% if success %}
        <div class="alert alert-success">
            <h4 class="alert-heading"><i class="bi bi-check-circle"></i> Credential Issued Successfully!</h4>
            <p>The verifiable credential has been created and is ready for use.</p>
            <hr>
            <p class="mb-0">Credential ID: <code>{{ credential_id }}</code></p>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-file-earmark-code"></i> Credential Data</h5>
            </div>
            <div class="card-body">
                <pre class="bg-light p-3 rounded"><code>{{ credential_data }}</code></pre>
            </div>
            <div class="card-footer">
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <button type="button" class="btn btn-outline-secondary" onclick="copyToClipboard()">Copy to Clipboard</button>
                    <a href="/verify" class="btn btn-primary">Verify This Credential</a>
                    <a href="/issue" class="btn btn-success">Issue Another Credential</a>
                </div>
            </div>
        </div>
        
        {% else %}
        <div class="alert alert-danger">
            <h4 class="alert-heading"><i class="bi bi-exclamation-triangle"></i> Credential Issuance Failed</h4>
            <p>{{ error }}</p>
            {% if error_details %}
            <hr>
            <details>
                <summary>Error Details</summary>
                <pre class="mt-2">{{ error_details }}</pre>
            </details>
            {% endif %}
        </div>
        
        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
            <a href="/issue" class="btn btn-primary">Try Again</a>
            <a href="/" class="btn btn-secondary">Back to Home</a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
{% if success %}
<script>
function copyToClipboard() {
    const credentialData = `{{ credential_data | safe }}`;
    navigator.clipboard.writeText(credentialData).then(function() {
        // Show success feedback
        const btn = event.target;
        const originalText = btn.textContent;
        btn.textContent = 'Copied!';
        btn.classList.remove('btn-outline-secondary');
        btn.classList.add('btn-success');
        
        setTimeout(function() {
            btn.textContent = originalText;
            btn.classList.remove('btn-success');
            btn.classList.add('btn-outline-secondary');
        }, 2000);
    }, function(err) {
        console.error('Could not copy text: ', err);
        alert('Failed to copy to clipboard');
    });
}
</script>
{% endif %}
{% endblock %}